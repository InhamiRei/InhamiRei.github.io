(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{284:function(s,a,n){"use strict";n.r(a);var e=n(12),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"建立连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建立连接"}},[s._v("#")]),s._v(" 建立连接")]),s._v(" "),n("el-tag",{attrs:{type:"info"}},[s._v("FinalShell 版本：3.9.2.2")]),s._v(" "),n("ul",[n("li",[s._v("点击连接管理器，选择建立新的连接，SSH 连接(Linux)")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/FinalShell_1.png"),alt:"FinalShell_1.png"}})]),s._v(" "),n("ul",[n("li",[s._v("编辑连接：")]),s._v(" "),n("li",[s._v("名称：自定义名称")]),s._v(" "),n("li",[s._v("主机：阿里云服务器 IP 地址(公)")]),s._v(" "),n("li",[s._v("用户名：root")]),s._v(" "),n("li",[s._v("密码：阿里云登录密码")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/FinalShell_2.png"),alt:"FinalShell_2.png"}})]),s._v(" "),n("ul",[n("li",[s._v("先去阿里云的控制台重置服务器的密码")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/FinalShell_3.png"),alt:"FinalShell_3.png"}})]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/FinalShell_4.png"),alt:"FinalShell_4.png"}})]),s._v(" "),n("h2",{attrs:{id:"环境配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境配置"}},[s._v("#")]),s._v(" 环境配置")]),s._v(" "),n("ul",[n("li",[s._v("升级系统和库的版本")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo apt-get update\nsudo apt-get upgrade\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("在执行第二条语句的时候可能会报以下的信息，选择 2，保存本地的版本")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("A new version (/tmp/fileMHkfUx) of configuration file /etc/ssh/sshd_config is available, but the version installed\ncurrently has been locally modified.\n\n  1. install the package maintainer's version             5. show a 3-way difference between available versions\n  2. keep the local version currently installed           6. do a 3-way merge between available versions\n  3. show the differences between the versions            7. start a new shell to examine the situation\n  4. show a side-by-side difference between the versions\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("安装 Git，nginx，Python3，uwsgi，django")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo apt-get install git\nsudo apt-get install nginx\nsudo apt-get install python3\nsudo apt-get install python3-pip\npip3 install uwsgi\npip3 install django\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("报错,python2 好像不能用了，这里就用 pip3")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo apt-get install --reinstall python3-pip\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"转移-python-项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#转移-python-项目"}},[s._v("#")]),s._v(" 转移 Python 项目")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("在 home 新建新的文件夹，home/sites/inhami.com/TaroTown")])]),s._v(" "),n("li",[n("p",[s._v("将项目都放进 TaroTown 里")])]),s._v(" "),n("li",[n("p",[s._v("注意 uwsgi.log 要定时清理，删除新建个空的，不然占用内存会越来越大")])]),s._v(" "),n("li",[n("p",[s._v("生成 requirements.txt，以便后面安装")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /home/sites/inhami.com/TaroTown/TaroTown\npip freeze > requirements.txt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"navicat-mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#navicat-mysql"}},[s._v("#")]),s._v(" Navicat+MySQL")]),s._v(" "),n("el-tag",{attrs:{type:"info"}},[s._v("Navicat Premium 版本：15.0.12")]),s._v(" "),n("ul",[n("li",[s._v("在服务器安装 MySQL")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo apt-get install mysql-server\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("修改配置")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo mysql_secure_installation\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("注意这个不允许远程连接选择否")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("...\nDisallow root login remotely? (Press y|Y for Yes, any other key for No) : n\n...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("查看 MySQL 状态")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemctl status mysql.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("配置端口 3306")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("netstat -an | grep 3306\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("在 Navicat 新建连接")]),s._v(" "),n("li",[s._v("连接名：随便写")]),s._v(" "),n("li",[s._v("主机：localhost")]),s._v(" "),n("li",[s._v("端口：3306")]),s._v(" "),n("li",[s._v("用户名：root")]),s._v(" "),n("li",[s._v("密码：数据库的密码，后面改了是 123")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/mysql_1.png"),alt:"mysql_1.png"}})]),s._v(" "),n("ul",[n("li",[s._v("主机：就是服务器的 IP 地址(公)")]),s._v(" "),n("li",[s._v("端口：22")]),s._v(" "),n("li",[s._v("用户名：root")]),s._v(" "),n("li",[s._v("验证方法：密码")]),s._v(" "),n("li",[s._v("密码：服务器的登录密码，不是数据库的密码，如果填数据库的密码，上面的 Navicat 图标到 SSH 服务器就会变红")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/mysql_2.png"),alt:"mysql_2.png"}})]),s._v(" "),n("ul",[n("li",[s._v("报错：说明 SSH 服务器和数据库连接失败")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1698 - Access deied for user 'root'@'localhost'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("进入数据库")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo mysql -u root -p\nselect user, plugin from mysql.user;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("网上搜到的，修改 mysql 配置")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("set global validate_password_policy=0;\n\nset global validate_password_mixed_case_count=0;\n\nset global validate_password_number_count=3;\n\nset global validate_password_special_char_count=0;\n\nset global validate_password_length=3;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("这里修改密码为 123 了，所以我的 Django 项目的 setting.py 的配置里面连接数据库的地方密码也要改成 123")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("update mysql.user set authentication_string=PASSWORD('123'), plugin='mysql_native_password' where user='root';\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("刷新")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("flush privileges;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("在远程创建一个数据库 town，编码为 utf8")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:s.$withBase("/img/community/mysql_3.png"),alt:"mysql_2.png"}})]),s._v(" "),n("ul",[n("li",[s._v("进入我的 Django 项目，迁移数据库")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /home/sites/inhami.com/TaroTown\npython3 manage.py makemigrations\npython3 manage.py migrate\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("数据库结构创好了，在 Navicat 选择转储 SQL 文件-结构和数据(直接把这个 sql 文件拖到 Navitcat 就可以了)")])]),s._v(" "),n("h2",{attrs:{id:"nginx-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" Nginx 配置")]),s._v(" "),n("ul",[n("li",[s._v("/etc/nginx/sites-available/defalut")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n\tlisten 80 default_server;\n\tlisten [::]:80 default_server;\n\n\troot /var/www/html;\n\n\tindex index.html index.htm index.nginx-debian.html;\n\n\tserver_name 服务器的IP地址(公);\n\n\tlocation / {\n\t\tinclude uwsgi_params;\n\t\t\tuwsgi_pass 127.0.0.1:8000;\n\t}\n\tlocation /static {\n\t\talias /home/sites/inhami.com/TaroTown/static;\n\t}\n\tlocation /media {\n\t\talias /home/sites/inhami.com/TaroTown/media;\n\t}\n}\n\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("ul",[n("li",[s._v("/etc/nginx/sites-available/inhami.com.conf")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('server {\n    listen       80;\n    listen\t 443 ssl http2;\n    server_name  inhami.com www.inhami.com;\n    charset utf-8;\n        ssl_certificate /etc/ssl/4734502_inhami.com.pem;\n        ssl_certificate_key /etc/ssl/4734502_inhami.com.key;\n        ssl_session_timeout 5m;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n        ssl_prefer_server_ciphers on;\n\n    set                         $rewriterule https;\n        if                      ($scheme = https) {\n            set                 $rewriterule "${rewriterule}7"; }\n        if                      ($host ~* ^inhami.com) {\n            set                 $rewriterule "${rewriterule}8"; }\n        if                      ($rewriterule != "https78") {\n            return              301 https://inhami.com$request_uri;\n            break; }\n\n    location / {\n        include uwsgi_params;\n        uwsgi_pass 127.0.0.1:8998;  #端口要和uwsgi里配置的一样\n        uwsgi_param UWSGI_SCRIPT TaroTown.wsgi;  #wsgi.py所在的目录名+.wsgi\n        uwsgi_param UWSGI_CHDIR /home/sites/inhami.com/TaroTown/; #项目路径\n        }\n    location /static/ {\n        alias /home/sites/inhami.com/TaroTown/static/; #静态资源路径\n        }\n    location /media/ {\n        alias /home/sites/inhami.com/TaroTown/media/; #静态资源路径\n        }\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("h2",{attrs:{id:"ssl-证书配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssl-证书配置"}},[s._v("#")]),s._v(" SSL 证书配置")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("先去阿里云的控制台 SSL 创建一个新的免费证书（一般证书只有 1 年期限）")])]),s._v(" "),n("li",[n("p",[s._v("下载证书，选择 Nginx 服务器类型的证书")])]),s._v(" "),n("li",[n("p",[s._v("SSL 证书文件两个放到/etc/ssl：xxxxxxx_inhami.com.key 和 xxxxxxx_inhami.com.PEM")])]),s._v(" "),n("li",[n("p",[s._v("修改/etc/nginx/sites-available 和/etc/nginx/sites-enabled 里的 inhami.com.conf 文件")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ssl_certificate /etc/ssl/4734502_inhami.com.pem;\nssl_certificate_key /etc/ssl/4734502_inhami.com.key;\nssl_certificate /etc/ssl/6528837_inhami.com.pem;\nssl_certificate_key /etc/ssl/6528837_inhami.com.key;\nssl_session_timeout 5m;\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\nssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\nssl_prefer_server_ciphers on;\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("如果只是替换过期的证书，按上述步骤完成后，前往阿里云控制台重启服务器")]),s._v(" "),n("li",[s._v("之后在 FinalShell 再次运行 Django 项目，不然访问会报 502 错误")]),s._v(" "),n("li",[s._v("点击域名左边的锁，可以看到证书是否更新")])]),s._v(" "),n("h2",{attrs:{id:"uwsgi-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uwsgi-配置"}},[s._v("#")]),s._v(" uWSGI 配置")]),s._v(" "),n("ul",[n("li",[s._v("在/home/sites/inhami.com/TaroTown/TaroTown 创建三个文件：")]),s._v(" "),n("li",[s._v("uwsgi.ini")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#添加配置选择\n[uwsgi]\n#配置和nginx连接的socket连接\nsocket=127.0.0.1:8998\n#配置项目路径，项目的所在目录\nchdir=/home/sites/inhami.com/TaroTown/\n#配置wsgi接口模块文件路径,也就是wsgi.py这个文件所在的目录名\nwsgi-file=TaroTown/wsgi.py\n#配置启动的进程数\nprocesses=4\n#配置每个进程的线程数\nthreads=2\n#配置启动管理主进程\nmaster=True\n#配置存放主进程的进程号文件\npidfile=uwsgi.pid\n#配置dump日志记录\ndaemonize=uwsgi.log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("uwsgi.log 放 uwsgi 的日志的，需定时清理")])]),s._v(" "),n("li",[n("p",[s._v("uwsgi.pid")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("27772\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"运行项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行项目"}},[s._v("#")]),s._v(" 运行项目")]),s._v(" "),n("ul",[n("li",[s._v("安装 requirements.txt")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("pip3 install -r requirements.txt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("收集静态资源")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("python3 manage.py collectstatic\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("运行")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("python3 manage.py runserve\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"定时任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[s._v("#")]),s._v(" 定时任务")]),s._v(" "),n("ul",[n("li",[s._v("添加定时任务")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("python manage.py crontab add\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("setting.py")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("CRONJOBS "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'59 23 * * *'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'townbase.views.my_scheduled_job'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("view.py")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定时任务-每日刷新")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_scheduled_job")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        需要执行的代码\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])],1)}),[],!1,null,null,null);a.default=t.exports}}]);